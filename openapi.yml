openapi: 3.0.3
info:
  title: Edge API
  version: "1.0.0"

servers:
  - url: http://192.168.1.1

paths:
  /edge/camera/capture:
    post:
      summary: Trigger camera capture
      operationId: captureCamera
      requestBody:
        description: Empty object to trigger capture
        required: true
        content:
          application/json:
            schema:
              type: object
              example: {}
      responses:
        "200":
          description: Capture result
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CaptureResponse"
  /edge/v2/block/segmentation/results:
    get:
      summary: Get block segmentation results by capture ID
      description: |
        Returns segmentation, mask, statistics, and region extraction
        results for all blocks under a given capture.
      parameters:
        - name: capture_id
          in: query
          required: true
          description: Capture ID
          schema:
            type: integer
            example: 89057
      responses:
        "200":
          description: Successful response
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SegmentationResult"
components:
  schemas:
    CaptureResponse:
      type: object
      required:
        - id
        - width
        - height
        - path
        - size
        - captured_at
        - camera_settings
        - source_recipe
      properties:
        id:
          type: integer
          example: 249685
        uuid:
          type: string
          nullable: true
        acq_mode_at_capture:
          type: integer
          example: 1
        captured_at:
          type: string
          format: date-time
          example: "Tue, 20 Jan 2026 08:54:24 GMT"
        width:
          type: integer
          example: 3840
        height:
          type: integer
          example: 2160
        size:
          type: integer
          example: 5351654
        path:
          type: string
          example: "718e035a-2e2d-49d4-956b-0ac2f6cd9ddc.jpg"
        is_deleted:
          type: boolean
          example: false
        led_mode:
          type: integer
          nullable: true
        process_end:
          type: string
          nullable: true
        trigger_id:
          type: integer
          nullable: true
        triggered_by:
          type: string
          example: manual
        camera_settings:
          $ref: "#/components/schemas/CameraSettings"
        source_recipe:
          $ref: "#/components/schemas/SourceRecipe"

    CameraSettings:
      type: object
      properties:
        acq_mode:
          type: integer
        aligner_trigger_debounce_ms:
          type: integer
        awb_blue:
          type: integer
        awb_green:
          type: integer
        awb_red:
          type: integer
        awb_op:
          type: boolean
        basler_light_source_preset:
          type: string
          example: Daylight5000K
        brightness:
          type: integer
        estimated_capture_time:
          type: integer
        exposure:
          type: integer
        focal_length:
          type: number
          format: float
        focus:
          type: integer
        focus_distance:
          type: integer
        gain:
          type: integer
        gamma:
          type: integer
        hdr_mode_enabled:
          type: boolean
        interval_trigger_period:
          type: integer
        led_gain:
          type: integer
        led_mode:
          type: integer
        led_strobe_mode:
          type: boolean
        lens_correct:
          type: boolean
        photometric_enabled:
          type: boolean
        photometric_mode:
          type: integer
        preview_image_path:
          type: string
        recipe_id:
          type: integer
        rotation_mode:
          type: integer
        smart_roi:
          nullable: true
        status:
          type: string
          example: ready
        trigger_debounce:
          type: integer
        trigger_delay:
          type: integer

    SourceRecipe:
      type: object
      properties:
        id:
          type: integer
          example: 549
        name:
          type: string
        description:
          type: string
        hmi_type:
          type: string
        plc_recipe_id:
          type: integer
        active:
          type: boolean
        is_deleted:
          type: boolean
        created_at:
          type: string
          format: date-time
        edited_at:
          type: string
          format: date-time
    SegmentationResult:
      type: object
      required:
        - id
        - blockId
        - captureId
        - imageScore
      properties:
        id:
          type: integer
          example: 284482
        blockId:
          type: integer
          example: 80
        captureId:
          type: integer
          example: 89057
        confidenceScoreThreshold:
          type: number
          format: float
          example: 0.5
        imageScore:
          type: number
          format: float
          example: 0.99768
        block:
          $ref: "#/components/schemas/Block"
        mask:
          type: string
          description: Base64 encoded PNG image
          example: data:image/png;base64,iVBORw0KGgoAAA...
        maskStats:
          $ref: "#/components/schemas/MaskStats"
        regionExtractionResult:
          $ref: "#/components/schemas/RegionExtractionResult"
        regionExtractionResultId:
          type: integer
          example: 2410364
        searchArea:
          $ref: "#/components/schemas/SearchArea"
        searchAreaId:
          type: integer
          example: 74

    Block:
      type: object
      properties:
        id:
          type: integer
          example: 80
        name:
          type: string
          example: Copper_Foil_Residue

    MaskStats:
      type: object
      properties:
        blobStatistics:
          type: array
          items:
            $ref: "#/components/schemas/BlobStatistic"
        classStatistics:
          type: array
          items:
            $ref: "#/components/schemas/ClassStatistic"

    BlobStatistic:
      type: object
      properties:
        angle:
          type: number
          format: float
        averageColor:
          type: array
          items:
            type: number
          minItems: 3
          maxItems: 3
        center:
          type: array
          items:
            type: number
          minItems: 2
          maxItems: 2
        centerGlobal:
          type: array
          items:
            type: number
          minItems: 2
          maxItems: 2
        centroid:
          type: array
          items:
            type: number
          minItems: 2
          maxItems: 2
        classId:
          type: integer
        className:
          type: string
        majorAxisLength:
          type: number
          format: float
        minorAxisLength:
          type: number
          format: float
        perimeter:
          type: number
          format: float
        pixelCount:
          type: integer

    ClassStatistic:
      type: object
      properties:
        classId:
          type: integer
        className:
          type: string
        numBlobs:
          type: integer
        pixelCount:
          type: integer

    RegionExtractionResult:
      type: object
      properties:
        id:
          type: integer
        alignmentResultId:
          type: integer
        alignmentResult:
          $ref: "#/components/schemas/AlignmentResult"
        inspectionRegionId:
          type: integer
        inspectionRegion:
          $ref: "#/components/schemas/InspectionRegion"
        fabricjsObject:
          $ref: "#/components/schemas/FabricJsObject"
        searchAreaId:
          type: integer

    AlignmentResult:
      type: object
      properties:
        id:
          type: integer
        blockId:
          type: integer
        captureId:
          type: integer
        angle:
          type: number
          format: float
        confidence:
          type: number
          format: float
        centerLoc:
          type: array
          items:
            type: number
          minItems: 2
          maxItems: 2
        affineMatrix:
          type: array
          items:
            type: array
            items:
              type: number
        searchAreaId:
          type: integer
        searchAreaBbox:
          type: array
          items:
            type: number

    InspectionRegion:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        angle:
          type: number
          format: float
        locked:
          type: boolean
        bbox:
          type: array
          items:
            type: number
        inspectionTypeId:
          type: integer
        inspectionType:
          $ref: "#/components/schemas/InspectionType"
        fabricjsObject:
          $ref: "#/components/schemas/FabricJsObject"

    InspectionType:
      type: object
      properties:
        id:
          type: integer
        blockId:
          type: integer
        name:
          type: string

    SearchArea:
      type: object
      properties:
        id:
          type: integer
        blockId:
          type: integer
        alignmentParamsId:
          type: integer
        main:
          type: boolean
        name:
          type: string
        searchAreaBbox:
          type: array
          items:
            type: number

    FabricJsObject:
      type: object
      description: Fabric.js serialized object
      additionalProperties: true